define("lesson/js/choice",["lesson/js/common"],function(t){var n=function(t){this.init(t)};return n.prototype={optionPannel:"#choice-pannel",tabPannel:"#choice-tab",contPannel:"#cont-pannel",init:function(t,n){this.properties(),n||this.bindEvents(),this.navTabRender({info:this.tabData,chapter_media:App.MEDIAINFO.chapter_media}),this.Render(),t&&t()},properties:function(){this.tabData=App.MEDIAINFO.select_id,this.sid=this.tabData[0].type_id,this.num=1,this.select_title=App.MEDIAINFO.select_title,this.type=App.MEDIAINFO.select_type,this.dataInfo=App.MEDIAINFO.info,this.optionJson=null,this.optionJson={},this.optionNum=0,this.Data=[]},Render:function(n){var i=this,n=n||this.dataReorgani(this.num,this.dataInfo);this.contRender(),this.choiceRender(n);var e={};$.each(this.Data,function(t,s){return s.key==i.num?(e.type=n.checked?"submit":"",e.redo=n.num>1?!1:!0,!1):void 0}),this.btnRender(e),$("#choice-scrollbar").scrollTop(0),t.emit("lesson.resize")},optionChange:function(t){this.optionJson[t.sid]=t.type,this.optionNum++;var n=$(this.tabPannel);$.each(this.optionJson,function(i,e){t.sid==i&&(e?n.find(".option"+i).removeClass("erro").addClass("succ"):n.find(".option"+i).removeClass("succ").addClass("erro"))})},optionDelete:function(t){$(this.tabPannel).find(".option"+t).removeClass("erro").removeClass("succ"),this.optionNum--,delete this.optionJson[t]},bindEvents:function(){var n=this;t.on("Choice.optionChange",function(t,i){n.optionChange(i)}),$(this.optionPannel).on("click",".js-submit",function(){n.submit()}).on("click",".item",function(){n.itemEvent($(this))}).on("click",".js-redo",function(){n.redo()}).on("click",".js-next",function(){n.next()}).on("click",".js-nextm",function(){window.location.href=App.NEXTMEDIAINFO?"#mid="+App.NEXTMEDIAINFO.id:OP_CONFIG.curCourse.href}),$(this.tabPannel).on("click","li",function(){if(!$(this).hasClass("active")){$(this).addClass("active").siblings("li").removeClass("active");var t={};t.sid=$(this).attr("data-id"),n.num=$(this).html(),n.switchChoice(t)}}).on("click",".prev",function(){return $(this).hasClass("not")?void $.alert("已经是第一个选择题了~"):(n.prev(),!1)}).on("click",".next",function(){return $(this).hasClass("not")?void $.alert("已经是最后一个选择题了~"):(n.next(),!1)})},prev:function(){var t=this,n=$(this.tabPannel).find(".active");n.prev("li").trigger("click"),t.notHandle()},next:function(){var t=this,n=$(this.tabPannel).find(".active");n.next("li").trigger("click"),t.notHandle()},notHandle:function(){var t=$(this.tabPannel),n=t.find(".active");n.prev("li")[0]?t.find(".prev").removeClass("not"):t.find(".prev").addClass("not"),n.next("li")[0]?t.find(".next").removeClass("not"):t.find(".next").addClass("not")},switchChoice:function(t){App.showPageLoad();var n=this,i={},e=!1;$.each(n.Data,function(t,s){return n.num==s.key?(e=!0,i=s,!1):void 0}),$.post("/course/PracticeInfo",t,function(s){1==s.result?(n.sid=t.sid,n.dataInfo=s.data.info,n.select_title=s.data.select_title,n.type=s.data.select_type,e?n.Render(i):n.Render()):$.alert(s.msg),App.hidePageLoad()},"json")},itemEvent:function(t){var n=$(this.optionPannel).find(".js-submit");if(!n[0])return!1;var i=t.parents("#choicebox"),e=i.hasClass("multi");t.hasClass("active")?t.removeClass("active"):(t.addClass("active"),e||t.siblings(".item").removeClass("active"))},submit:function(){var n=this,i={};return i.sid=this.sid,i.oid="",i.tid="",$(this.optionPannel).find(".item").each(function(e){if($(this).hasClass("active")){var s=$(this).attr("data-id");i.oid+=s+=",",i.tid+=t.converType(e)+",",$.each(n.Data,function(t,i){n.num==i.key&&(i.info[e].checked=!0)})}}),i.oid=i.oid.substr(0,i.oid.length-1),i.tid=i.tid.substr(0,i.tid.length-1),""==i.oid?($.alert("你还没做选择"),!1):void n.submitCallback(i)},submitCallback:function(n){var i=this,e=!1;$.each(this.Data,function(s,o){o.key==i.num&&(o.answer==n.tid&&(e=!0),o.num++,o.checked=n.tid,e&&(o.success=!0),t.emit("Choice.optionChange",{sid:n.sid,type:e}),i.choiceRender(o),o.checked&&$("#choice-scrollbar").scrollTop(1e4),t.emit("lesson.resize"),i.btnRender({type:"submit",redo:o.num>1?!1:!0,next:!1}))}),i.optionNum==i.tabData.length&&t.emit("lesson.finish")},redo:function(){var t=this;$.each(this.Data,function(n,i){i.key==t.num&&(i.checked=!1,i.success=!1,$.each(i.info,function(t,n){n.checked=!1}),t.choiceRender(i),t.btnRender(),t.optionDelete(t.sid))})},btnRender:function(t){var t=t||{};"undefined"!=typeof t.type&&("submit"!=t.type||$(this.tabPannel).find(".active").next("li")[0]||(App.NEXTMEDIAINFO?t.next=!0:t.course=!0)),btnTpl=$("#choiceBtn-tpl").html(),btnHtmls="",btnHtmls=juicer(btnTpl,{data:t}),$(this.optionPannel).find(".choice-btnwrap").html(btnHtmls)},navTabRender:function(t){tabTpl=$("#choicetab-tpl").html(),tabHtmls="",tabHtmls=juicer(tabTpl,{data:t}),$(this.tabPannel).html(tabHtmls)},contRender:function(){var t=this.num||1,n="";n+='<div class="cont-title-wrap">',n+='<div class="cont-title">',n+="<span>"+t+". </span>",n+=1==this.type?"单选题":"多选题",n+="</div>",n+='<div class="cont-desc ueword">',n+=this.select_title,n+="</div>",$(this.contPannel).find(".content").html(n)},choiceRender:function(t){t.type=this.type;var n=$("#choicelist-tpl").html(),i="";i=juicer(n,{data:t}),$(this.optionPannel).find(".inner").html(i)},dataReorgani:function(n,i){var e={};e.key=n,e.info=[],e.checked=!1,e.success=!1,e.num=0,e.answer="";for(var s=0;s<i.length;s++)e.info.push({type:t.converType(s),id:i[s].id,name:i[s].name,checked:!1}),1==i[s].is_answer&&(e.answer+=t.converType(s)+",");return e.answer=e.answer.substr(0,e.answer.length-1),this.Data.push(e),e}},{init:function(t){return new n(t)}}});