define("common/js/complete_user_info",["require","jqueryValidate"],function(){jQuery.validator.addMethod("phoneb",function(i,e){var s=/^(13[0-9]|14[56789]|15[012356789]|16[6]|17[0-9]|18[0-9]|19[89])[0-9]{8}$/g;return this.optional(e)||s.test(i)}),jQuery.validator.addMethod("email",function(i,e){var s=/^[a-zA-Z0-9]+([._\-][a-zA-Z0-9]+)*@([a-zA-Z0-9]+([._\-][a-zA-Z0-9]+))+$/;return this.optional(e)||s.test(i)}),jQuery.validator.addMethod("password",function(i,e){var s=/^[\w~`!@#$%&*()_+<>?:"'+*\/\-\^\\\][{}]{6,16}$/;return this.optional(e)||s.test(i)});var i,e=$("#improve-mode"),s=0,t="",r=0,o=0,n="";window.onload=function(){function d(){var i=$(".moco-modal-layer"),e=$(window).width(),s=$(window).height(),t=$(".moco-modal-layer").width(),r=$(".moco-modal-layer").height(),o=e/2-t/2,n=s/2-r/2;i.size()>0&&$(".moco-modal-layer").css({left:o,top:n})}if(s=0,e.size()>0){var l=$("#improve-mode").prop("outerHTML"),g=$.dialog(l,{title:"完善个人信息",modal:!0});g.boxy.find(".moco-icon-close").hide();var c=function(i){clearInterval(o),o=null,n=i.code,t=i.pubkey,r=i.servertime,setInterval(function(){r++},1e3)},u=$(".moco-modal-layer .improve").data("flag");switch(i=$(".moco-modal-layer .improve").validate({errorPlacement:function(i,e){$(e).closest(".box").find(".help-inline").html("").append($(i))}}),u){case 1:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}}),$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}}),$(".moco-modal-layer .js-password").rules("add",{required:!0,password:!0,messages:{required:"请输入登录密码",password:"密码格式不正确"}});break;case 2:$(".moco-modal-layer .js-phone").rules("add",{required:!0,phoneb:!0,messages:{required:"请输入手机号码",phoneb:"请输入正确的手机号码"}}),$(".moco-modal-layer .js-mobileverify").rules("add",{required:!0,messages:{required:"请输入验证码"}});break;case 3:$(".moco-modal-layer .js-email").rules("add",{required:!0,email:!0,messages:{required:"请输入邮箱",email:"请输入正确的邮箱地址"}})}}window.onresize=function(){d()},$(".moco-modal-layer").delegate(".js-phone","change",function(){s=0});var m=function(i,e){if(i.hasClass("sending"))return!1;var t=$(".moco-modal-layer .getCode");i.addClass("sending"),t.closest(".improve").find(".js-phone").siblings(".help-inline").html("");var r,o=60;r=setInterval(function(){if(0>=o)clearInterval(r),t.closest(".improve").find(".js-phone").siblings(".help-inline").html(""),t.addClass("active").text("短信接收").removeClass("sending"),t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'),i.removeClass("sending");else{var e=--o+"s 后重新获取";t.text(e).removeClass("active"),$(".moco-modal-layer .js-voicecode-send").remove()}},1e3);var n=$(".moco-modal-layer .js-phone").val(),a={phone:n,noverify:1};1==s&&(a.forcebind=1),1==e&&(a.typecode=1),$.ajax({url:"/passport/user/checkphonecode",type:"post",data:a,dataType:"json",success:function(e){if(10001!=e.status)if(90013==e.status){var o='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';t.closest(".improve").find(".js-phone").siblings(".help-inline").html(o),clearInterval(r),t.html("短信接收"),t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'),s=0}else 11011==e.status?$.alert(e.msg):11012==e.status?$.alert(e.msg):(t.closest(".improve").find(".js-phone").siblings(".help-inline").html(e.msg),clearInterval(r),i.removeClass("sending"),t.html("短信接收"),0==$(".moco-modal-layer .js-voicecode-send").length&&t.after('<p class="voicecode-send js-voicecode-send"><i class="imv2-vol_up"></i>语音接听</p>'))}})};$(".moco-modal-layer").on("click",".getCode",function(){m($(this),0)}).on("click",".js-voicecode-send",function(){m($(this),1)}).on("click",".submitBtn",function(){var e=$(this),t=$(".moco-modal-layer .js-phone").val(),o=$(".moco-modal-layer .js-mobileverify").val(),d=$(".moco-modal-layer .js-email").val(),l=$(".moco-modal-layer .js-password").val();if(i.form()){$(".moco-modal-layer .js-password").size()>0&&($.ajax({url:"/passport/user/prelogin",async:!1,type:"post",dataType:"json",success:function(i){10001==i.status&&c(i)}}),l=a(n+"	"+r+"	"+l),l=window.btoa(l));var g={phone:t,mobileverify:o,email:d,password:l};1==s&&(g.forcebind=1),$.ajax({url:"/passport/user/completeuserinfo",type:"post",data:g,dataType:"json",success:function(i){if(10001!=i.status&&11010!=i.status)if(90013==i.status){var e='手机号码已被使用，是否强制绑定到现有账户中？<i class="js-mandatory-yes">是</i>';$(".js-phone").siblings(".help-inline").html(e),$(".moco-modal-layer").find(".getCode").addClass("sending"),s=0}else if(11011==i.status)$.alert(i.msg);else if(11012==i.status)$.alert(i.msg);else for(var t in i.data)$(".js-"+t).closest(".box").find(".help-inline").html(i.data[t].msg);else 11010==i.status?window.location.href=window.location.href:($(".js-modal-close").click(),$.alert("恭喜你，完善个人信息成功"))},error:function(){e.closest(".box").find("help-inline").html("服务器无响应，稍后重试")}})}}).on("click",".js-pw",function(){$(this).hasClass("cur")?($(".moco-modal-layer .js-password").attr("type","password"),$(this).removeClass("cur")):($(".moco-modal-layer .js-password").attr("type","text"),$(this).addClass("cur"))}).on("click",".cancelBtn",function(){$(".js-modal-close").click()}),$(".help-inline").delegate(".js-mandatory-yes","click",function(){s=1,$(".moco-modal-layer").find(".getCode").removeClass("sending"),$(".getCode").trigger("click"),$(this).parent(".help-inline").html("")})};var a=function(i){function e(i){I=i,T=new Array(I);for(var e=0;e<T.length;e++)T[e]=0;Z=new s,Q=new s,Q.digits[0]=1}function s(i){this.digits="boolean"==typeof i&&1==i?null:T.slice(0),this.isNeg=!1}function r(i){var e=new s(!0);return e.digits=i.digits.slice(0),e.isNeg=i.isNeg,e}function o(i){var e=new s;e.isNeg=0>i,i=Math.abs(i);for(var t=0;i>0;)e.digits[t++]=i&D,i>>=B;return e}function n(i){var e,s=48,t=s+9,r=97,o=r+25,n=65,a=90;return e=i>=s&&t>=i?i-s:i>=n&&a>=i?10+i-n:i>=r&&o>=i?10+i-r:0}function a(i){for(var e=0,s=Math.min(i.length,4),t=0;s>t;++t)e<<=4,e|=n(i.charCodeAt(t));return e}function d(i){for(var e=new s,t=i.length,r=t,o=0;r>0;r-=4,++o)e.digits[o]=a(i.substr(Math.max(r-4,0),Math.min(r,4)));return e}function l(i){for(var e="",s=m(i);s>-1;--s)e+=g(i.digits[s]);return e}function g(i){var e=String.fromCharCode(255&i);i>>>=8;var s=String.fromCharCode(255&i);return s+e}function c(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=u(i,e),e.isNeg=!e.isNeg;else{t=new s;for(var r,o=0,n=0;n<i.digits.length;++n)r=i.digits[n]+e.digits[n]+o,t.digits[n]=65535&r,o=Number(r>=L);t.isNeg=i.isNeg}return t}function u(i,e){var t;if(i.isNeg!=e.isNeg)e.isNeg=!e.isNeg,t=c(i,e),e.isNeg=!e.isNeg;else{t=new s;var r,o;o=0;for(var n=0;n<i.digits.length;++n)r=i.digits[n]-e.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=L),o=0-Number(0>r);if(-1==o){o=0;for(var n=0;n<i.digits.length;++n)r=0-t.digits[n]+o,t.digits[n]=65535&r,t.digits[n]<0&&(t.digits[n]+=L),o=0-Number(0>r);t.isNeg=!i.isNeg}else t.isNeg=i.isNeg}return t}function m(i){for(var e=i.digits.length-1;e>0&&0==i.digits[e];)--e;return e}function h(i){var e,s=m(i),t=i.digits[s],r=(s+1)*H;for(e=r;e>r-H&&0==(32768&t);--e)t<<=1;return e}function f(i,e){for(var t,r,o,n=new s,a=m(i),d=m(e),l=0;d>=l;++l){for(t=0,o=l,j=0;a>=j;++j,++o)r=n.digits[o]+i.digits[j]*e.digits[l]+t,n.digits[o]=r&D,t=r>>>B;n.digits[l+a+1]=t}return n.isNeg=i.isNeg!=e.isNeg,n}function v(i,e){var t,r,o;result=new s,t=m(i),r=0;for(var n=0;t>=n;++n)o=result.digits[n]+i.digits[n]*e+r,result.digits[n]=o&D,r=o>>>B;return result.digits[1+t]=r,result}function p(i,e,s,t,r){for(var o=Math.min(e+r,i.length),n=e,a=t;o>n;++n,++a)s[a]=i[n]}function y(i,e){var t=Math.floor(e/H),r=new s;p(i.digits,0,r.digits,t,r.digits.length-t);for(var o=e%H,n=H-o,a=r.digits.length-1,d=a-1;a>0;--a,--d)r.digits[a]=r.digits[a]<<o&D|(r.digits[d]&E[o])>>>n;return r.digits[0]=r.digits[a]<<o&D,r.isNeg=i.isNeg,r}function w(i,e){var t=Math.floor(e/H),r=new s;p(i.digits,t,r.digits,0,i.digits.length-t);for(var o=e%H,n=H-o,a=0,d=a+1;a<r.digits.length-1;++a,++d)r.digits[a]=r.digits[a]>>>o|(r.digits[d]&F[o])<<n;return r.digits[r.digits.length-1]>>>=o,r.isNeg=i.isNeg,r}function $(i,e){var t=new s;return p(i.digits,0,t.digits,e,t.digits.length-e),t}function N(i,e){var t=new s;return p(i.digits,e,t.digits,0,t.digits.length-e),t}function b(i,e){var t=new s;return p(i.digits,0,t.digits,0,e),t}function k(i,e){if(i.isNeg!=e.isNeg)return 1-2*Number(i.isNeg);for(var s=i.digits.length-1;s>=0;--s)if(i.digits[s]!=e.digits[s])return i.isNeg?1-2*Number(i.digits[s]>e.digits[s]):1-2*Number(i.digits[s]<e.digits[s]);return 0}function M(i,e){var t,o,n=h(i),a=h(e),d=e.isNeg;if(a>n)return i.isNeg?(t=r(Q),t.isNeg=!e.isNeg,i.isNeg=!1,e.isNeg=!1,o=u(e,i),i.isNeg=!0,e.isNeg=d):(t=new s,o=r(i)),new Array(t,o);t=new s,o=i;for(var l=Math.ceil(a/H)-1,g=0;e.digits[l]<P;)e=y(e,1),++g,++a,l=Math.ceil(a/H)-1;o=y(o,g),n+=g;for(var f=Math.ceil(n/H)-1,p=$(e,f-l);-1!=k(o,p);)++t.digits[f-l],o=u(o,p);for(var N=f;N>l;--N){var j=N>=o.digits.length?0:o.digits[N],b=N-1>=o.digits.length?0:o.digits[N-1],M=N-2>=o.digits.length?0:o.digits[N-2],C=l>=e.digits.length?0:e.digits[l],z=l-1>=e.digits.length?0:e.digits[l-1];t.digits[N-l-1]=j==C?D:Math.floor((j*L+b)/C);for(var q=t.digits[N-l-1]*(C*L+z),A=j*V+(b*L+M);q>A;)--t.digits[N-l-1],q=t.digits[N-l-1]*(C*L|z),A=j*L*L+(b*L+M);p=$(e,N-l-1),o=u(o,v(p,t.digits[N-l-1])),o.isNeg&&(o=c(o,p),--t.digits[N-l-1])}return o=w(o,g),t.isNeg=i.isNeg!=d,i.isNeg&&(t=d?c(t,Q):u(t,Q),e=w(e,g),o=u(e,o)),0==o.digits[0]&&0==m(o)&&(o.isNeg=!1),new Array(t,o)}function C(i,e){return M(i,e)[0]}function z(i){this.modulus=r(i),this.k=m(this.modulus)+1;var e=new s;e.digits[2*this.k]=1,this.mu=C(e,this.modulus),this.bkplus1=new s,this.bkplus1.digits[this.k+1]=1,this.modulo=q,this.multiplyMod=A,this.powMod=x}function q(i){var e=N(i,this.k-1),s=f(e,this.mu),t=N(s,this.k+1),r=b(i,this.k+1),o=f(t,this.modulus),n=b(o,this.k+1),a=u(r,n);a.isNeg&&(a=c(a,this.bkplus1));for(var d=k(a,this.modulus)>=0;d;)a=u(a,this.modulus),d=k(a,this.modulus)>=0;return a}function A(i,e){var s=f(i,e);return this.modulo(s)}function x(i,e){var t=new s;t.digits[0]=1;for(var r=i,o=e;;){if(0!=(1&o.digits[0])&&(t=this.multiplyMod(t,r)),o=w(o,1),0==o.digits[0]&&0==m(o))break;r=this.multiplyMod(r,r)}return t}function S(i){var e=1024;this.e=d("10001"),this.d=d(""),this.m=d(i),this.chunkSize="number"!=typeof e?2*m(this.m):e/8,this.radix=16,this.barrett=new z(this.m)}function _(i){var e,r,o,n,a,d,g,c,u=new Array,m=i.length,h="",f=new S(t);for(m>f.chunkSize-11&&(m=f.chunkSize-11),e=0,r=m-1;m>e;)u[r]=i.charCodeAt(e),e++,r--;for(r=f.chunkSize-m%f.chunkSize;r>0;){for(n=Math.floor(256*Math.random());!n;)n=Math.floor(256*Math.random());u[e]=n,e++,r--}for(u[m]=0,u[f.chunkSize-2]=2,u[f.chunkSize-1]=0,a=u.length,e=0;a>e;e+=f.chunkSize){for(d=new s,r=0,o=e;o<e+f.chunkSize;++r)d.digits[r]=u[o++],d.digits[r]+=u[o++]<<8;g=f.barrett.powMod(d,f.e),c=l(g),h+=c}return h}var I,T,Z,Q,B=16,H=B,L=65536,P=L>>>1,V=L*L,D=L-1;e(20);var E=(o(1e15),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"),new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535)),F=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);return e(131),_(i)}});