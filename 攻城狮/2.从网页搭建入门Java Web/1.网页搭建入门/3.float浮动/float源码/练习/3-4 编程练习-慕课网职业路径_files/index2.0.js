define("lesson/index2.0",["lesson/js/common","store","lesson/js/asidebar","common/js/antifake","/static/lib/mocoplayer/2.7.1/mocoplayer.js","juicer","pagination"],function(e,t,i,n){window.App={};var o={Choice:null,CodeEditor:null,Task:null};App={init:function(){var t=this;if(this.properties(),this.Monitor(),this.bindEvents(),a.init(),OP_CONFIG.mid=$.hash("mid"),OP_CONFIG.mid){var i={left:"#lessonLeft",right:"#lessonRight",dragger:"#lessonDrag",container:"#lessonwrap",resize:function(){"video"==t.MEDIAMODE&&s.resize()},stop:function(){e.emit("lesson.resize")}};e.idrag.create(i);var n=["#cont-pannel","#choice-pannel"];moco.imagePreview.init(n),$(window).on("hashchange",function(){p.reset(),t.hashchange()}),$(window).resize(function(){e.emit("lesson.resize")}),e.on("lesson.finish",function(e,t){p.send2(!1,!1,!1,!0,t)}),this.loadMedia(OP_CONFIG.mid)}},Api:{init:"/lesson/ajaxmediainfo"},MEDIAINFO:{},NEXTMEDIAINFO:{},MEDIAMODE:"",programdata:null,properties:function(){this.$LessonParent=$("#lessonwrap"),this.$mediaName=$("#g-media-name"),this.$RightParent=$("#lessonRight"),this.$pageLoad=$("#pageload"),this.$mend=$("#mend"),this.getFiles=null,this.Msg=["提交正确。","敲的漂亮。","Wow，好厉害。","成功了，让编程来的更猛烈些吧。","不错，慕兄我看好你！","Nice，你这是年薪过百万的节奏啊！","God，你离成神已经不远了！","这你都能通过，无法直视你的双眸。","好，让我们继续一起愉快的玩耍吧。"]},picTime:function(){return s.getPoint()},bindEvents:function(){var e='<div class="cont-video-container" id="cont-video-container"></div>',t=!1;$("#cont-pannel").on("click",".js-cont-video-btn",function(){var e=$(this).attr("data-url");require(["common/js/player"],function(i){$("#cont-video-container").show(),$(".js-cont-close-video").show(),i.init({id:"cont-video-container",url:e,videotitile:"视频",width:"100%",height:"400",autostart:!1,events:{onReady:function(){this.play()},onPause:function(){$("#cont-pannel").find(".jwcontrolbar").show(),t=!1},onPlay:function(){setTimeout(function(){$("#cont-pannel").find(".jwcontrolbar").hide(),t=!0},300)},onComplete:function(){t=!1}}}),$(".cont-video").on("mouseover",function(){t&&$("#cont-pannel").find(".jwcontrolbar").show()}).on("mouseout",function(){t&&$("#cont-pannel").find(".jwcontrolbar").hide()})})}),$("#cont-pannel").on("click",".js-cont-close-video",function(){$("#cont-video-container").remove(),$(".js-cont-close-video").hide(),$(this).after(e)})},hashchange:function(){if("iPad"==navigator.platform)return void window.location.reload(!0);var e=0,i=OP_CONFIG.mid;window.thePlayer&&window.thePlayer.getCurrentTime&&(e=window.thePlayer.getCurrentTime());var n=t.get("_vt")||{},o=n[i];$("#next-mask").hasClass("in")?delete n[i]:o?(o.t=(new Date).getTime(),o.st=e):(o={t:(new Date).getTime(),st:e},n[i]=o);try{t.set("_vt",n)}catch(a){}var s=$.hash("mid");OP_CONFIG.mid=s,s&&this.switchPage(s)},switchPage:function(e){$("#chapterlist").hasClass("active")&&$(".js-chapter").trigger("click"),window.thePlayer&&(window.thePlayer.pause(),n.stop()),this.showPageLoad(),this.loadMedia(e)},loadMedia:function(t,i,n){var o=this;$.ajax({url:o.Api.init,data:{mid:t},type:"get",dataType:"json",success:function(t){return 0!=t.result?""==t.data?void(window.location.href="/course/"+OP_CONFIG.curCourse.id):void(window.location.href=t.data):(1==OP_CONFIG.later&&(1==t.data.type?$(".js-switch-pic").show():$(".js-switch-pic").hide(),2==t.data.type?App.programdata=t.data.programdata:5==t.data.type&&(App.programdata=t.data.offline)),App.MEDIAINFO=t.data.media_info,App.NEXTMEDIAINFO=t.data.next_media_info||null,i&&i(t.data.media_info),e.emit("lesson.mediaChange",t.data.media_info),void 0)},error:function(){$.alert("系统错误！")},complete:function(){"function"==typeof n&&n()}})},setMediaName:function(){this.$mediaName.html(this.MEDIAINFO.chapter_seqid+"-"+this.MEDIAINFO.seqid+" "+this.MEDIAINFO.name)},hidePageLoad:function(){this.$pageLoad.addClass("out").fadeOut(300)},showPageLoad:function(){this.$pageLoad.removeClass("out").fadeIn(300)},showGuideModal:function(){var e=this,t=$("#guide-modal-tpl").html(),i=$("body");i.append(juicer(t,{})),$("#guide-modal-wrap .guide-nav").on("click",function(){e.hideGuideModal()}),setTimeout(function(){$("#guide-modal-wrap").addClass("showed"),$("#guide-modal-block").addClass("showed")},30)},hideGuideModal:function(){$("#guide-modal-wrap").removeClass("showed"),$("#guide-modal-block").removeClass("showed"),setTimeout(function(){$("#guide-modal-wrap").remove(),$("#guide-modal-block").remove(),s.playVideo()},600)},Monitor:function(){var t=this,i=$("#addexp"),n=null,o=function(){clearTimeout(n),i.removeClass("active")};e.on("lesson.mediaChange",function(i,n){$("#note-pannel").hasClass("active")&&$("#note-pannel").find(".js-close").click(),$("#qa-pannel").hasClass("active")&&$("#qa-pannel").find(".js-close").click(),o(),t.$LessonParent.attr("class","lessonwrap"),2==OP_CONFIG.later?1==n.type?(App.MEDIAMODE="video",t.$LessonParent.addClass("video"),$("#asidebar .js-wenda").click(),$("#lessonLeft").width("60%"),$("#lessonRight").css("left","60%"),$("#lessonDrag").show()):($("#lessonLeft").width("100%"),$("#lessonDrag").hide(),2==n.type?App.MEDIAMODE="code":3==n.type?App.MEDIAMODE="choice":4==n.type&&(App.MEDIAMODE="task"),t.$LessonParent.addClass("renewal")):1==n.type?(App.MEDIAMODE="video",t.$LessonParent.addClass("video min")):2==n.type?(App.MEDIAMODE="code",t.$LessonParent.addClass("code")):3==n.type?(App.MEDIAMODE="choice",t.$LessonParent.addClass("choice")):4==n.type?(App.MEDIAMODE="task",t.$LessonParent.addClass("task")):5==n.type&&(App.MEDIAMODE="freecode",t.$LessonParent.addClass("freecode")),e.emit("lesson.pagePrepared")}),e.on("lesson.pagePrepared",function(){document.title="choice"==App.MEDIAMODE?App.MEDIAINFO.chapter_media+" 选择题-慕课网职业路径":"task"==App.MEDIAMODE?App.MEDIAINFO.chapter_media+" 作业题-慕课网职业路径":"code"==App.MEDIAMODE?App.MEDIAINFO.chapter_media+" 编程练习-慕课网职业路径":"freecode"==App.MEDIAMODE?App.MEDIAINFO.chapter_media+" 自由编程-慕课网职业路径":"video"==App.MEDIAMODE?App.MEDIAINFO.chapter_media+" "+App.MEDIAINFO.name+"-慕课网职业路径":"职业路径-慕课网职业路径",t.hidePageLoad()}),e.on("lesson.mpRaised",function(e,t){i.find(".t").html("+ "+t.experience.mp.point+" MP"),i.find(".b").html(t.experience.mp.desc),i.addClass("active"),"undefined"!=typeof t.push_ask&&0!=t.push_ask.length&&$("#qa-tip").show(),n=setTimeout(function(){o()},5e3)}),e.on("code.checked",function(e,i){var i=i||{};i.cid=OP_CONFIG.curCourse.id,"success"==i.type&&(i.msg=t.Msg[Math.floor(Math.random()*t.Msg.length)]),OP_CONFIG.is_skip&&(i.msg="该节编程练习不验证代码，你可以各种尝试"),App.NEXTMEDIAINFO&&(i.mid=App.NEXTMEDIAINFO.id),$("#codeTab").append(juicer($("#code-checked-tpl").html(),i)).find(".code-tip").height(96),$(".js-trycode").one("click",function(){$("#codeTab").find(".code-tip").height(0),setTimeout(function(){$("#codeTab").find(".code-tip-opa").remove()},100)})})}};var a={init:function(){var t=this;e.on("lesson.mediaChange",function(e,i){p.reset(),p.start(),t.mediaChange(i)}),e.on("lesson.resize",function(){s.resize()})},callback:function(){var t=[];t.push("#cont-scrollbar"),"choice"==App.MEDIAMODE?t.push("#choice-scrollbar"):"task"==App.MEDIAMODE&&t.push("#task-scrollbar"),setTimeout(function(){e.pannelScrollbarInit(t)},500),e.emit("lesson.pagePrepared")},mediaChange:function(){var e=this;if(window.thePlayer&&window.thePlayer.destroy&&(window.thePlayer.destroy(),window.thePlayer=null),2==OP_CONFIG.later&&"video"!=App.MEDIAMODE)return void require(["lesson/js/renewal"],function(){});if("choice"==App.MEDIAMODE){if(o.Choice)return void o.Choice.init(this.callback,!0);require(["lesson/js/choice"],function(t){o.Choice=t.init(e.callback)})}else if("code"==App.MEDIAMODE)r.init(e.callback);else if("freecode"==App.MEDIAMODE)d.init(e.callback);else if("video"==App.MEDIAMODE)App.setMediaName(),s.start(),s.mask.hide(),s.resize();else if("task"==App.MEDIAMODE){if(o.Task)return void o.Task.init(e.callback,!0);require(["lesson/js/task"],function(t){o.Task=t.init(e.callback)})}}},s={pannel:"#video-pannel",start:function(){if(this.show(),this.play(),this.bindEvents(),App.NEXTMEDIAINFO)this.rendNext(App.NEXTMEDIAINFO);else{var e={over:!0,cid:OP_CONFIG.curCourse.id};this.rendNext(e)}},bindEvents:function(){var e=this;$("#next-mask").on("click",".js-view-again",function(){e.review()})},show:function(){$(this.pannel).show()},hide:function(){$(this.pannel).hide()},rendNext:function(e){var t=$("#next-media-tpl").html(),i=$("#next-media-content");i.html(juicer(t,e))},destroy:function(e){this.hide(),this.mask.hide(!0),p.send2(!1,null,e),this.inst&&this.inst.destroy()},review:function(){this.mask.hide(),window.thePlayer.play(),p.start()},pause:function(){window.thePlayer.pause(),p.reset()},getState:function(){return window.thePlayer.getState()},playVideo:function(){window.thePlayer.play(),p.start()},mask:{dom:$("#next-mask"),show:function(){this.dom.addClass("in")},hide:function(){this.dom.removeClass("in")}},resize:function(){},showGuideModal:function(){t.get("video_first")||(t.set("video_first","1"),this.pause(),App.showGuideModal())},play:function(){n.stop();var i=this,o=0,a=null,s=App.MEDIAINFO.id;a=t.get("_vt"),a&&a[s]&&(o=a[s].st||0),$.post("/user/loginhistory",{uid:OP_CONFIG.userInfo.uid,browser_key:OP_CONFIG.browser_key,from_course:OP_CONFIG.curCourse.id+"-"+s}),window.thePlayer&&window.thePlayer.destroy&&(window.thePlayer.destroy(),window.thePlayer=null);for(var d=!0,r=[2,20],c=0;c<r.length;c++)r[c]==OP_CONFIG.plan_id&&(d=!1);var l="http://class.imooc.com/lesson/m3u8h5?mid="+s+"&cid="+OP_CONFIG.curCourse.id,h=window.location.protocol.split(":")[0];"https"===h&&(l="https://class.imooc.com/lesson/m3u8h5?mid="+s+"&cid="+OP_CONFIG.curCourse.id+"&ssl=1"),window.thePlayer=mocoplayer($("#video-container"),{url:l,title:App.MEDIAINFO.name,showAd:d,currentTime:o,uid:OP_CONFIG.userInfo.uid,phone:OP_CONFIG.userInfo.uid,events:{onReady:function(){if("html5"==this.getPlayType()){var t=this,a=2e3;o||!d?a=0:$("#video-container").append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;						    	background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),videoBox=$("#video-container video"),setTimeout(function(){$("#js-video-copyright").remove(),t.play(),n.start()},a)}e.emit("lesson.pagePrepared"),i.showGuideModal()},onComplete:function(){p.send2(!0,function(e){e.experience,p.reset()}),i.mask.show(),"html5"==this.getPlayType()&&n.stop()},onError:function(){}}})},getPoint:function(){var e=0;return window.thePlayer&&window.thePlayer.getCurrentTime&&(e=window.thePlayer.getCurrentTime()),Math.floor(e)}},d={pannel:"#code-pannel",init:function(t){var i=App.programdata;i.chapter_seqid=App.MEDIAINFO.chapter_seqid,i.seqid=App.MEDIAINFO.seqid,i.name=App.MEDIAINFO.name,i.file_url&&(i.file_url="//climg.mukewang.com/down/"+i.file_url+"."+i.filetype);var n=$("#freeCont-tpl").html(),o=$("#cont-pannel .content"),a=juicer(n,i);o.html(a),t&&t(),$(".js-cont-video-btn").length&&$(".js-cont-video-btn").click(),"0"==App.MEDIAINFO.user_finished&&setTimeout(function(){e.emit("lesson.finish")},3e4)}},r={pannel:"#code-pannel",init:function(e){var t=this,i="#codeTab .files-block";this.change(),this.loadCodeIde(function(){o.CodeEditor?(t._init(e,!0),o.CodeEditor.init($(i))):require(["lesson/js/code"],function(n){o.CodeEditor=n.create($(i)),t._init(e)}),t.codedrag()})},codedrag:function(){var t=0;$("#viewPort-content").find(".dragiframe")[0]&&(t=1);var i={left:"#codeTab",right:"#viewPort-content",dragger:"#codeDrag",container:"#lessonRightinner",str:"code",start:function(){t&&$("#viewPort-content").find(".dragiframe").hide()},stop:function(){t&&$("#viewPort-content").find(".dragiframe").show()}};e.idrag.create(i)},_init:function(e,t){t||this.bindEvents(),App.getFiles=o.CodeEditor.getFiles(),e&&e()},loadCodeIde:function(e){var t=this;$.ajax({type:"GET",url:"/lesson/code?mid="+App.MEDIAINFO.id,dataType:"html",success:function(i){""!=i&&($(t.pannel).html(i),e&&e())}})},bindEvents:function(){$(this.pannel).on("click",".js-run",function(){1==$(this).attr("data-ssh")?(o.CodeEditor.saveCode(),o.CodeEditor.oldcommit()):o.CodeEditor.commit()}).on("click",".js-reset",function(){o.CodeEditor.resetCode()}).on("click",".js-code-screen",function(){o.CodeEditor.screenCode()}),$("#J_VC_Commit").on("click",function(){var e=$(".js-verify-code-box .verify-code-ipt").val();return 0==e.length?($(".js-verify-code-box .js-verify-code-tip").html("验证码不能为空").show(),!1):e.length>4?($(".js-verify-code-box .js-verify-code-tip").html("验证码错误").show(),!1):($("#J_VC_Commit").addClass("submiting").val("提交中..."),void o.CodeEditor.commit(e))})},change:function(){var e=App.programdata;e.chapter_seqid=App.MEDIAINFO.chapter_seqid,e.seqid=App.MEDIAINFO.seqid,e.name=App.MEDIAINFO.name,e.videourl=e.video_url;var t=$("#codeCont-tpl").html(),i=$("#cont-pannel .content"),n=juicer(t,e);i.html(n)}},c=function(){$(".bottom-box").delegate(".js-change-qa","click",function(){var e=parseInt($(".showqa").attr("data-qanum")),t=$(this).data("sum"),i=Number(t-1),n=Number(e+1);e==i?n=0:n>i&&(n=0),$(".js-"+e).addClass("hideqa").removeClass("showqa"),$(".js-"+n).removeClass("hideqa").addClass("showqa")}),$(".qa-tip").delegate(".js-close","click",function(){$("#qa-tip").hide()})},l=function(e){var t=0;"undefined"!=typeof e.type&&0!=e.type&&(t=1);var i="";i+='<i class="trangle"></i>				<i class="close-btn imv2-close js-close"></i>',i+=0!=t?'<p class="small-title">问题热烈讨论中，来看看吧</p>':'<p class="small-title">帮同学解答一个问题吧</p>',$.each(e.list,function(n){var o="hideqa";o=0==n?"showqa":"hideqa",i+='<div class="qa-detail '+o+" js-"+n+'"  data-qanum="'+n+'">						<a class="qa-title" href="//class.imooc.com/course/qadetail/'+e.list[n].id+'" target="_blank">							<span class="imv2-help"></span>							'+e.list[n].title+'						</a>						<div class="bottom-box clearfix">',i+=0!=t?'<span class="l add-credit">最高可获3积分</span>':'<span class="l add-exp">巩固知识</span>						<span class="l add-credit">获得学分</span>',i+='<a href="//class.imooc.com/course/qadetail/'+e.list[n].id+'" class="go-answer r js-close" target="_blank">我来回答</a>',e.list.length>1&&(i+='<div class="r change-qa js-change-qa" data-sum="'+e.list.length+'">换个问题</div>'),i+="</div></div>"}),$("#qa-tip").html(i),c()},p=function(){return function(i){if(OP_CONFIG.userInfo){var n=i,o=(new Date).getTime(),a=((new Date).getTime(),null),s=(App.MEDIAMODE,function(t,i,a,s,d){var c,p,h={};c=(new Date).getTime(),p=parseInt(c-o)/1e3,h.mid=a||App.MEDIAINFO.id,h.learn_time=p,"video"==App.MEDIAMODE&&(h.video_point=n.getPoint()),"undefined"!=typeof s&&1==s&&(h.isfinish=1);var u={url:"/lesson/ajaxmediauser",data:h,type:"POST",dataType:"json",success:function(t){if(0==t.result){if(o=c,t.data&&(e.emit("lesson.mpRaised",t.data),"undefined"!=typeof t.data.push_ask&&0!=t.data.push_ask.length)){var i=t.data.push_ask;l(i)}}else"-101011"==t.result?r.reset():"-105002"==t.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="//www.imooc.com/course/program"}});d&&d()}},m=m||!0;m===!1&&(u.async=!1),$.ajax(u)}),d=function(){a=window.setInterval(function(){s(!0,function(){})},3e4)},r={send2:function(e,t,i,n,o){s(e,t,i,n,o)},reset:function(){o=(new Date).getTime(),a&&clearInterval(a),a=null},start:function(){this.reset(),d()}};return window.onbeforeunload=function(){var e=0;if(window.thePlayer&&window.thePlayer.getCurrentTime&&(e=window.thePlayer.getCurrentTime()),App.MEDIAINFO){var i=t.get("_vt")||{},n=i[App.MEDIAINFO.id];$("#next-mask").hasClass("in")?delete i[App.MEDIAINFO.id]:n?(n.t=(new Date).getTime(),n.st=e):(n={t:(new Date).getTime(),st:e},i[App.MEDIAINFO.id]=n),t.set("_vt",i)}s(!1)},r}}(s)}(),h=function(){App.init(),i.init()};h()});